(function() {
  module.exports = function(colorPicker) {
    return {
      Emitter: (require('../modules/Emitter'))(),
      element: null,
      control: null,
      canvas: null,
      emitSelectionChanged: function() {
        return this.Emitter.emit('selectionChanged', this.control.selection);
      },
      onSelectionChanged: function(callback) {
        return this.Emitter.on('selectionChanged', callback);
      },
      emitColorChanged: function() {
        return this.Emitter.emit('colorChanged', this.control.selection.color);
      },
      onColorChanged: function(callback) {
        return this.Emitter.on('colorChanged', callback);
      },
      activate: function() {
        var Body;
        Body = colorPicker.getExtension('Body');
        this.element = {
          el: (function() {
            var _classPrefix, _el;
            _classPrefix = Body.element.el.className;
            _el = document.createElement('div');
            _el.classList.add(_classPrefix + "-alpha");
            return _el;
          })(),
          width: 0,
          height: 0,
          getWidth: function() {
            return this.width || this.el.offsetWidth;
          },
          getHeight: function() {
            return this.height || this.el.offsetHeight;
          },
          rect: null,
          getRect: function() {
            return this.rect || this.updateRect();
          },
          updateRect: function() {
            return this.rect = this.el.getClientRects()[0];
          },
          add: function(element) {
            this.el.appendChild(element);
            return this;
          }
        };
        Body.element.add(this.element.el, 1);
        colorPicker.onOpen((function(_this) {
          return function() {
            return _this.element.updateRect();
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var Alpha, Saturation, _elementHeight, _elementWidth;
            Alpha = _this;
            Saturation = colorPicker.getExtension('Saturation');
            _elementWidth = _this.element.getWidth();
            _elementHeight = _this.element.getHeight();
            _this.canvas = {
              el: (function() {
                var _el;
                _el = document.createElement('canvas');
                _el.width = _elementWidth;
                _el.height = _elementHeight;
                _el.classList.add(Alpha.element.el.className + "-canvas");
                return _el;
              })(),
              context: null,
              getContext: function() {
                return this.context || (this.context = this.el.getContext('2d'));
              },
              previousRender: null,
              render: function(smartColor) {
                var _context, _gradient, _rgb;
                _rgb = ((function() {
                  if (!smartColor) {
                    return colorPicker.SmartColor.HEX('#f00');
                  } else {
                    return smartColor;
                  }
                })()).toRGBArray().join(',');
                if (this.previousRender && this.previousRender === _rgb) {
                  return;
                }
                _context = this.getContext();
                _context.clearRect(0, 0, _elementWidth, _elementHeight);
                _gradient = _context.createLinearGradient(0, 0, 1, _elementHeight);
                _gradient.addColorStop(.01, "rgba(" + _rgb + ",1)");
                _gradient.addColorStop(.99, "rgba(" + _rgb + ",0)");
                _context.fillStyle = _gradient;
                _context.fillRect(0, 0, _elementWidth, _elementHeight);
                return this.previousRender = _rgb;
              }
            };
            Saturation.onColorChanged(function(smartColor) {
              return _this.canvas.render(smartColor);
            });
            _this.canvas.render();
            return _this.element.add(_this.canvas.el);
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var Alpha, Saturation, hasChild;
            hasChild = function(element, child) {
              var _parent;
              if (child && (_parent = child.parentNode)) {
                if (child === element) {
                  return true;
                } else {
                  return hasChild(element, _parent);
                }
              }
              return false;
            };
            Alpha = _this;
            Saturation = colorPicker.getExtension('Saturation');
            _this.control = {
              el: (function() {
                var _el;
                _el = document.createElement('div');
                _el.classList.add(Alpha.element.el.className + "-control");
                return _el;
              })(),
              isGrabbing: false,
              previousControlPosition: null,
              updateControlPosition: function(y) {
                var _joined;
                _joined = "," + y;
                if (this.previousControlPosition && this.previousControlPosition === _joined) {
                  return;
                }
                requestAnimationFrame((function(_this) {
                  return function() {
                    return _this.el.style.top = y + "px";
                  };
                })(this));
                return this.previousControlPosition = _joined;
              },
              selection: {
                y: 0,
                color: null,
                alpha: null
              },
              setSelection: function(e, alpha, offset) {
                var _RGBAArray, _alpha, _height, _position, _rect, _smartColor, _width, _y;
                if (alpha == null) {
                  alpha = null;
                }
                if (offset == null) {
                  offset = null;
                }
                _rect = Alpha.element.getRect();
                _width = Alpha.element.getWidth();
                _height = Alpha.element.getHeight();
                if (e) {
                  _y = e.pageY - _rect.top;
                } else if (typeof alpha === 'number') {
                  _y = _height - (alpha * _height);
                } else if (typeof offset === 'number') {
                  _y = this.selection.y + offset;
                } else {
                  _y = this.selection.y;
                }
                _y = this.selection.y = Math.max(0, Math.min(_height, _y));
                _alpha = 1 - (_y / _height);
                this.selection.alpha = (Math.round(_alpha * 100)) / 100;
                if (_smartColor = this.selection.color) {
                  _RGBAArray = _smartColor.toRGBAArray();
                  _RGBAArray[3] = this.selection.alpha;
                  this.selection.color = colorPicker.SmartColor.RGBAArray(_RGBAArray);
                  Alpha.emitColorChanged();
                } else {
                  this.selection.color = colorPicker.SmartColor.RGBAArray([255, 0, 0, this.selection.alpha]);
                }
                _position = {
                  y: Math.max(3, Math.min(_height - 6, _y))
                };
                this.updateControlPosition(_position.y);
                return Alpha.emitSelectionChanged();
              },
              refreshSelection: function() {
                return this.setSelection();
              }
            };
            _this.control.refreshSelection();
            colorPicker.onInputColor(function(smartColor) {
              return _this.control.setSelection(null, smartColor.getAlpha());
            });
            colorPicker.onOpen(function() {
              return _this.control.isGrabbing = false;
            });
            colorPicker.onClose(function() {
              return _this.control.isGrabbing = false;
            });
            Saturation.onColorChanged(function(smartColor) {
              _this.control.selection.color = smartColor;
              return _this.control.refreshSelection();
            });
            colorPicker.onMouseDown(function(e, isOnPicker) {
              if (!(isOnPicker && hasChild(Alpha.element.el, e.target))) {
                return;
              }
              e.preventDefault();
              _this.control.isGrabbing = true;
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseMove(function(e) {
              if (!_this.control.isGrabbing) {
                return;
              }
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseUp(function(e) {
              if (!_this.control.isGrabbing) {
                return;
              }
              _this.control.isGrabbing = false;
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseWheel(function(e, isOnPicker) {
              if (!(isOnPicker && hasChild(Alpha.element.el, e.target))) {
                return;
              }
              e.preventDefault();
              return _this.control.setSelection(null, null, e.wheelDeltaY * .33);
            });
            return _this.element.add(_this.control.el);
          };
        })(this));
        return this;
      }
    };
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL1VzZXJzL2V2YW5oZW5kcml4MS8uYXRvbS9wYWNrYWdlcy9jb2xvci1waWNrZXIvbGliL2V4dGVuc2lvbnMvQWxwaGEuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtJO0VBQUEsTUFBTSxDQUFDLE9BQVAsR0FBaUIsU0FBQyxXQUFEO1dBQ2I7TUFBQSxPQUFBLEVBQVMsQ0FBQyxPQUFBLENBQVEsb0JBQVIsQ0FBRCxDQUFBLENBQUEsQ0FBVDtNQUVBLE9BQUEsRUFBUyxJQUZUO01BR0EsT0FBQSxFQUFTLElBSFQ7TUFJQSxNQUFBLEVBQVEsSUFKUjtNQVVBLG9CQUFBLEVBQXNCLFNBQUE7ZUFDbEIsSUFBQyxDQUFBLE9BQU8sQ0FBQyxJQUFULENBQWMsa0JBQWQsRUFBa0MsSUFBQyxDQUFBLE9BQU8sQ0FBQyxTQUEzQztNQURrQixDQVZ0QjtNQVlBLGtCQUFBLEVBQW9CLFNBQUMsUUFBRDtlQUNoQixJQUFDLENBQUEsT0FBTyxDQUFDLEVBQVQsQ0FBWSxrQkFBWixFQUFnQyxRQUFoQztNQURnQixDQVpwQjtNQWdCQSxnQkFBQSxFQUFrQixTQUFBO2VBQ2QsSUFBQyxDQUFBLE9BQU8sQ0FBQyxJQUFULENBQWMsY0FBZCxFQUE4QixJQUFDLENBQUEsT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFqRDtNQURjLENBaEJsQjtNQWtCQSxjQUFBLEVBQWdCLFNBQUMsUUFBRDtlQUNaLElBQUMsQ0FBQSxPQUFPLENBQUMsRUFBVCxDQUFZLGNBQVosRUFBNEIsUUFBNUI7TUFEWSxDQWxCaEI7TUF3QkEsUUFBQSxFQUFVLFNBQUE7QUFDTixZQUFBO1FBQUEsSUFBQSxHQUFPLFdBQVcsQ0FBQyxZQUFaLENBQXlCLE1BQXpCO1FBSVAsSUFBQyxDQUFBLE9BQUQsR0FDSTtVQUFBLEVBQUEsRUFBTyxDQUFBLFNBQUE7QUFDSCxnQkFBQTtZQUFBLFlBQUEsR0FBZSxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FB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Q0FBYSxLQUFDLENBQUEsT0FBTyxDQUFDLEVBQXRCO1VBMUdPO1FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFYO0FBMkdBLGVBQU87TUFwTUQsQ0F4QlY7O0VBRGE7QUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiMgIENvbG9yIFBpY2tlci9leHRlbnNpb25zOiBBbHBoYVxuIyAgQ29sb3IgQWxwaGEgY29udHJvbGxlclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IChjb2xvclBpY2tlcikgLT5cbiAgICAgICAgRW1pdHRlcjogKHJlcXVpcmUgJy4uL21vZHVsZXMvRW1pdHRlcicpKClcblxuICAgICAgICBlbGVtZW50OiBudWxsXG4gICAgICAgIGNvbnRyb2w6IG51bGxcbiAgICAgICAgY2FudmFzOiBudWxsXG5cbiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAjICBTZXQgdXAgZXZlbnRzIGFuZCBoYW5kbGluZ1xuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAjIFNlbGVjdGlvbiBDaGFuZ2VkIGV2ZW50XG4gICAgICAgIGVtaXRTZWxlY3Rpb25DaGFuZ2VkOiAtPlxuICAgICAgICAgICAgQEVtaXR0ZXIuZW1pdCAnc2VsZWN0aW9uQ2hhbmdlZCcsIEBjb250cm9sLnNlbGVjdGlvblxuICAgICAgICBvblNlbGVjdGlvbkNoYW5nZWQ6IChjYWxsYmFjaykgLT5cbiAgICAgICAgICAgIEBFbWl0dGVyLm9uICdzZWxlY3Rpb25DaGFuZ2VkJywgY2FsbGJhY2tcblxuICAgICAgICAjIENvbG9yIENoYW5nZWQgZXZlbnRcbiAgICAgICAgZW1pdENvbG9yQ2hhbmdlZDogLT5cbiAgICAgICAgICAgIEBFbWl0dGVyLmVtaXQgJ2NvbG9yQ2hhbmdlZCcsIEBjb250cm9sLnNlbGVjdGlvbi5jb2xvclxuICAgICAgICBvbkNvbG9yQ2hhbmdlZDogKGNhbGxiYWNrKSAtPlxuICAgICAgICAgICAgQEVtaXR0ZXIub24gJ2NvbG9yQ2hhbmdlZCcsIGNhbGxiYWNrXG5cbiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAjICBDcmVhdGUgYW5kIGFjdGl2YXRlIEFscGhhIGNvbnRyb2xsZXJcbiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgYWN0aXZhdGU6IC0+XG4gICAgICAgICAgICBCb2R5ID0gY29sb3JQaWNrZXIuZ2V0RXh0ZW5zaW9uICdCb2R5J1xuXG4gICAgICAgICMgIENyZWF0ZSBlbGVtZW50XG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBAZWxlbWVudCA9XG4gICAgICAgICAgICAgICAgZWw6IGRvIC0+XG4gICAgICAgICAgICAgICAgICAgIF9jbGFzc1ByZWZpeCA9IEJvZHkuZWxlbWVudC5lbC5jbGFzc05hbWVcbiAgICAgICAgICAgICAgICAgICAgX2VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAnZGl2J1xuICAgICAgICAgICAgICAgICAgICBfZWwuY2xhc3NMaXN0LmFkZCBcIiN7IF9jbGFzc1ByZWZpeCB9LWFscGhhXCJcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2VsXG4gICAgICAgICAgICAgICAgIyBVdGlsaXR5IGZ1bmN0aW9uc1xuICAgICAgICAgICAgICAgIHdpZHRoOiAwXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAwXG4gICAgICAgICAgICAgICAgZ2V0V2lkdGg6IC0+IHJldHVybiBAd2lkdGggb3IgQGVsLm9mZnNldFdpZHRoXG4gICAgICAgICAgICAgICAgZ2V0SGVpZ2h0OiAtPiByZXR1cm4gQGhlaWdodCBvciBAZWwub2Zmc2V0SGVpZ2h0XG5cbiAgICAgICAgICAgICAgICByZWN0OiBudWxsXG4gICAgICAgICAgICAgICAgZ2V0UmVjdDogLT4gcmV0dXJuIEByZWN0IG9yIEB1cGRhdGVSZWN0KClcbiAgICAgICAgICAgICAgICB1cGRhdGVSZWN0OiAtPiBAcmVjdCA9IEBlbC5nZXRDbGllbnRSZWN0cygpWzBdXG5cbiAgICAgICAgICAgICAgICAjIEFkZCBhIGNoaWxkIG9uIHRoZSBBbHBoYSBlbGVtZW50XG4gICAgICAgICAgICAgICAgYWRkOiAoZWxlbWVudCkgLT5cbiAgICAgICAgICAgICAgICAgICAgQGVsLmFwcGVuZENoaWxkIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgICAgIEJvZHkuZWxlbWVudC5hZGQgQGVsZW1lbnQuZWwsIDFcblxuICAgICAgICAjICBVcGRhdGUgZWxlbWVudCByZWN0IHBvc2l0aW9uIHdoZW4gQ29sb3IgUGlja2VyIG9wZW5zXG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBjb2xvclBpY2tlci5vbk9wZW4gPT4gQGVsZW1lbnQudXBkYXRlUmVjdCgpXG5cbiAgICAgICAgIyAgQ3JlYXRlIGFuZCBkcmF3IGNhbnZhc1xuICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgc2V0VGltZW91dCA9PiAjIHdhaXQgZm9yIHRoZSBET01cbiAgICAgICAgICAgICAgICBBbHBoYSA9IHRoaXNcbiAgICAgICAgICAgICAgICBTYXR1cmF0aW9uID0gY29sb3JQaWNrZXIuZ2V0RXh0ZW5zaW9uICdTYXR1cmF0aW9uJ1xuXG4gICAgICAgICAgICAgICAgIyBQcmVwYXJlIHNvbWUgdmFyaWFibGVzXG4gICAgICAgICAgICAgICAgX2VsZW1lbnRXaWR0aCA9IEBlbGVtZW50LmdldFdpZHRoKClcbiAgICAgICAgICAgICAgICBfZWxlbWVudEhlaWdodCA9IEBlbGVtZW50LmdldEhlaWdodCgpXG5cbiAgICAgICAgICAgICAgICAjIENyZWF0ZSBjYW52YXMgZWxlbWVudFxuICAgICAgICAgICAgICAgIEBjYW52YXMgPVxuICAgICAgICAgICAgICAgICAgICBlbDogZG8gLT5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgJ2NhbnZhcydcbiAgICAgICAgICAgICAgICAgICAgICAgIF9lbC53aWR0aCA9IF9lbGVtZW50V2lkdGhcbiAgICAgICAgICAgICAgICAgICAgICAgIF9lbC5oZWlnaHQgPSBfZWxlbWVudEhlaWdodFxuICAgICAgICAgICAgICAgICAgICAgICAgX2VsLmNsYXNzTGlzdC5hZGQgXCIjeyBBbHBoYS5lbGVtZW50LmVsLmNsYXNzTmFtZSB9LWNhbnZhc1wiXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfZWxcbiAgICAgICAgICAgICAgICAgICAgIyBVdGlsaXR5IGZ1bmN0aW9uc1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBudWxsXG4gICAgICAgICAgICAgICAgICAgIGdldENvbnRleHQ6IC0+IEBjb250ZXh0IG9yIChAY29udGV4dCA9IEBlbC5nZXRDb250ZXh0ICcyZCcpXG5cbiAgICAgICAgICAgICAgICAgICAgIyBSZW5kZXIgQWxwaGEgY2FudmFzXG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzUmVuZGVyOiBudWxsXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcjogKHNtYXJ0Q29sb3IpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBfcmdiID0gKCBkbyAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVubGVzcyBzbWFydENvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2xvclBpY2tlci5TbWFydENvbG9yLkhFWCAnI2YwMCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBzbWFydENvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICApLnRvUkdCQXJyYXkoKS5qb2luICcsJ1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWYgQHByZXZpb3VzUmVuZGVyIGFuZCBAcHJldmlvdXNSZW5kZXIgaXMgX3JnYlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAjIEdldCBjb250ZXh0IGFuZCBjbGVhciBpdFxuICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQgPSBAZ2V0Q29udGV4dCgpXG4gICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5jbGVhclJlY3QgMCwgMCwgX2VsZW1lbnRXaWR0aCwgX2VsZW1lbnRIZWlnaHRcblxuICAgICAgICAgICAgICAgICAgICAgICAgIyBEcmF3IGFscGhhIGNoYW5uZWxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9ncmFkaWVudCA9IF9jb250ZXh0LmNyZWF0ZUxpbmVhckdyYWRpZW50IDAsIDAsIDEsIF9lbGVtZW50SGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICAgICBfZ3JhZGllbnQuYWRkQ29sb3JTdG9wIC4wMSwgXCJyZ2JhKCN7IF9yZ2IgfSwxKVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBfZ3JhZGllbnQuYWRkQ29sb3JTdG9wIC45OSwgXCJyZ2JhKCN7IF9yZ2IgfSwwKVwiXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LmZpbGxTdHlsZSA9IF9ncmFkaWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQuZmlsbFJlY3QgMCwgMCwgX2VsZW1lbnRXaWR0aCwgX2VsZW1lbnRIZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBAcHJldmlvdXNSZW5kZXIgPSBfcmdiXG5cbiAgICAgICAgICAgICAgICAjIFJlbmRlciBhZ2FpbiBvbiBTYXR1cmF0aW9uIGNvbG9yIGNoYW5nZVxuICAgICAgICAgICAgICAgIFNhdHVyYXRpb24ub25Db2xvckNoYW5nZWQgKHNtYXJ0Q29sb3IpID0+XG4gICAgICAgICAgICAgICAgICAgIEBjYW52YXMucmVuZGVyIHNtYXJ0Q29sb3JcbiAgICAgICAgICAgICAgICBAY2FudmFzLnJlbmRlcigpXG5cbiAgICAgICAgICAgICAgICAjIEFkZCB0byBBbHBoYSBlbGVtZW50XG4gICAgICAgICAgICAgICAgQGVsZW1lbnQuYWRkIEBjYW52YXMuZWxcblxuICAgICAgICAjICBDcmVhdGUgQWxwaGEgY29udHJvbCBlbGVtZW50XG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBzZXRUaW1lb3V0ID0+ICMgd2FpdCBmb3IgdGhlIERPTVxuICAgICAgICAgICAgICAgIGhhc0NoaWxkID0gKGVsZW1lbnQsIGNoaWxkKSAtPlxuICAgICAgICAgICAgICAgICAgICBpZiBjaGlsZCBhbmQgX3BhcmVudCA9IGNoaWxkLnBhcmVudE5vZGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoaWxkIGlzIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gaGFzQ2hpbGQgZWxlbWVudCwgX3BhcmVudFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcblxuICAgICAgICAgICAgICAgICMgQ3JlYXRlIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBBbHBoYSA9IHRoaXNcbiAgICAgICAgICAgICAgICBTYXR1cmF0aW9uID0gY29sb3JQaWNrZXIuZ2V0RXh0ZW5zaW9uICdTYXR1cmF0aW9uJ1xuXG4gICAgICAgICAgICAgICAgQGNvbnRyb2wgPVxuICAgICAgICAgICAgICAgICAgICBlbDogZG8gLT5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgJ2RpdidcbiAgICAgICAgICAgICAgICAgICAgICAgIF9lbC5jbGFzc0xpc3QuYWRkIFwiI3sgQWxwaGEuZWxlbWVudC5lbC5jbGFzc05hbWUgfS1jb250cm9sXCJcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9lbFxuICAgICAgICAgICAgICAgICAgICBpc0dyYWJiaW5nOiBub1xuXG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzQ29udHJvbFBvc2l0aW9uOiBudWxsXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNvbnRyb2xQb3NpdGlvbjogKHkpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBfam9pbmVkID0gXCIsI3sgeSB9XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpZiBAcHJldmlvdXNDb250cm9sUG9zaXRpb24gYW5kIEBwcmV2aW91c0NvbnRyb2xQb3NpdGlvbiBpcyBfam9pbmVkXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBlbC5zdHlsZS50b3AgPSBcIiN7IHkgfXB4XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBAcHJldmlvdXNDb250cm9sUG9zaXRpb24gPSBfam9pbmVkXG5cbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uOlxuICAgICAgICAgICAgICAgICAgICAgICAgeTogMFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhOiBudWxsXG4gICAgICAgICAgICAgICAgICAgIHNldFNlbGVjdGlvbjogKGUsIGFscGhhPW51bGwsIG9mZnNldD1udWxsKSAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgX3JlY3QgPSBBbHBoYS5lbGVtZW50LmdldFJlY3QoKVxuICAgICAgICAgICAgICAgICAgICAgICAgX3dpZHRoID0gQWxwaGEuZWxlbWVudC5nZXRXaWR0aCgpXG4gICAgICAgICAgICAgICAgICAgICAgICBfaGVpZ2h0ID0gQWxwaGEuZWxlbWVudC5nZXRIZWlnaHQoKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiBlIHRoZW4gX3kgPSBlLnBhZ2VZIC0gX3JlY3QudG9wXG4gICAgICAgICAgICAgICAgICAgICAgICAjIFNldCB0aGUgYWxwaGEgZGlyZWN0bHlcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBhbHBoYSBpcyAnbnVtYmVyJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfeSA9IF9oZWlnaHQgLSAoYWxwaGEgKiBfaGVpZ2h0KSAjIHJldmVyc2VkLCAxIGlzIHRvcFxuICAgICAgICAgICAgICAgICAgICAgICAgIyBIYW5kbGUgc2Nyb2xsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2Zmc2V0IGlzICdudW1iZXInKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF95ID0gQHNlbGVjdGlvbi55ICsgb2Zmc2V0XG4gICAgICAgICAgICAgICAgICAgICAgICAjIERlZmF1bHQgdG8gcHJldmlvdXMgdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIF95ID0gQHNlbGVjdGlvbi55XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF95ID0gQHNlbGVjdGlvbi55ID0gTWF0aC5tYXggMCwgKE1hdGgubWluIF9oZWlnaHQsIF95KVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBfYWxwaGEgPSAxIC0gKF95IC8gX2hlaWdodCkgIyByZXZlcnNlZCwgMSBpcyB0b3BcbiAgICAgICAgICAgICAgICAgICAgICAgIEBzZWxlY3Rpb24uYWxwaGEgPSAoTWF0aC5yb3VuZCBfYWxwaGEgKiAxMDApIC8gMTAwICMgMiBkZWNpbWFsIHByZWNpc2lvblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAjIFVwZGF0ZSB0aGUgc21hcnRDb2xvciAoaWYgYW55KVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgX3NtYXJ0Q29sb3IgPSBAc2VsZWN0aW9uLmNvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1JHQkFBcnJheSA9IF9zbWFydENvbG9yLnRvUkdCQUFycmF5KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfUkdCQUFycmF5WzNdID0gQHNlbGVjdGlvbi5hbHBoYVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQHNlbGVjdGlvbi5jb2xvciA9IGNvbG9yUGlja2VyLlNtYXJ0Q29sb3IuUkdCQUFycmF5IF9SR0JBQXJyYXlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbHBoYS5lbWl0Q29sb3JDaGFuZ2VkKClcbiAgICAgICAgICAgICAgICAgICAgICAgICMgT3Igc2V0IGEgZGVmYXVsdCByZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgQHNlbGVjdGlvbi5jb2xvciA9IGNvbG9yUGlja2VyLlNtYXJ0Q29sb3IuUkdCQUFycmF5IFsyNTUsIDAsIDAsIEBzZWxlY3Rpb24uYWxwaGFdXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9wb3NpdGlvbiA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogTWF0aC5tYXggMywgKE1hdGgubWluIChfaGVpZ2h0IC0gNiksIF95KVxuICAgICAgICAgICAgICAgICAgICAgICAgQHVwZGF0ZUNvbnRyb2xQb3NpdGlvbiBfcG9zaXRpb24ueVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQWxwaGEuZW1pdFNlbGVjdGlvbkNoYW5nZWQoKVxuXG4gICAgICAgICAgICAgICAgICAgIHJlZnJlc2hTZWxlY3Rpb246IC0+IEBzZXRTZWxlY3Rpb24oKVxuICAgICAgICAgICAgICAgIEBjb250cm9sLnJlZnJlc2hTZWxlY3Rpb24oKVxuXG4gICAgICAgICAgICAgICAgIyBJZiB0aGUgQ29sb3IgUGlja2VyIGlzIGZlZCBhIGNvbG9yLCBzZXQgaXRcbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbklucHV0Q29sb3IgKHNtYXJ0Q29sb3IpID0+XG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnNldFNlbGVjdGlvbiBudWxsLCBzbWFydENvbG9yLmdldEFscGhhKClcblxuICAgICAgICAgICAgICAgICMgUmVzZXRcbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbk9wZW4gPT4gQGNvbnRyb2wuaXNHcmFiYmluZyA9IG5vXG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25DbG9zZSA9PiBAY29udHJvbC5pc0dyYWJiaW5nID0gbm9cblxuICAgICAgICAgICAgICAgICMgQmluZCBjb250cm9sbGVyIGV2ZW50c1xuICAgICAgICAgICAgICAgIFNhdHVyYXRpb24ub25Db2xvckNoYW5nZWQgKHNtYXJ0Q29sb3IpID0+XG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnNlbGVjdGlvbi5jb2xvciA9IHNtYXJ0Q29sb3JcbiAgICAgICAgICAgICAgICAgICAgQGNvbnRyb2wucmVmcmVzaFNlbGVjdGlvbigpXG5cbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbk1vdXNlRG93biAoZSwgaXNPblBpY2tlcikgPT5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBpc09uUGlja2VyIGFuZCBoYXNDaGlsZCBBbHBoYS5lbGVtZW50LmVsLCBlLnRhcmdldFxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgICAgICAgICAgQGNvbnRyb2wuaXNHcmFiYmluZyA9IHllc1xuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5zZXRTZWxlY3Rpb24gZVxuXG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25Nb3VzZU1vdmUgKGUpID0+XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmxlc3MgQGNvbnRyb2wuaXNHcmFiYmluZ1xuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5zZXRTZWxlY3Rpb24gZVxuXG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25Nb3VzZVVwIChlKSA9PlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5sZXNzIEBjb250cm9sLmlzR3JhYmJpbmdcbiAgICAgICAgICAgICAgICAgICAgQGNvbnRyb2wuaXNHcmFiYmluZyA9IG5vXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnNldFNlbGVjdGlvbiBlXG5cbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbk1vdXNlV2hlZWwgKGUsIGlzT25QaWNrZXIpID0+XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmxlc3MgaXNPblBpY2tlciBhbmQgaGFzQ2hpbGQgQWxwaGEuZWxlbWVudC5lbCwgZS50YXJnZXRcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnNldFNlbGVjdGlvbiBudWxsLCBudWxsLCAoZS53aGVlbERlbHRhWSAqIC4zMykgIyBtYWtlIGl0IGEgYml0IHNvZnRlclxuXG4gICAgICAgICAgICAgICAgIyBBZGQgdG8gQWxwaGEgZWxlbWVudFxuICAgICAgICAgICAgICAgIEBlbGVtZW50LmFkZCBAY29udHJvbC5lbFxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiJdfQ==
